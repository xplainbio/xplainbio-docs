# Анализ образцов

## Настройки образца

При загрузке файлов или ручном создании образцов необходимо выбрать соответствующий материалу тип поиска мутаций &ndash; герминальные (например, для крови) или соматические (например, для блоков FFPE), а также тип анализа для применяемого метода подготовки библиотек &ndash; зонды (для гибридизационных технологий) или ампликоны (для амплификационных технологий).

## Результат анализа

Процесс анализа образца на облачной платформе XplainBio занимает от 20-30 минут для таргетных панелей до нескольких часов для экзомов и геномов. После успешного завершения анализа пользователю становятся доступны:

* Таблица образцов проекта &ndash; в компактном виде показывает ключевые параметры анализа (в зависимости от режима Обычный/QC/Скрининг):
  * количество обнаруженных вариантов
  * статусы образца и анализа
  * параметры критериев качества
  * панель доступных действий с образцом
  * общий размер привязанных файлов
  * количество прочтений
  * доля дубликатов
  * доля прочтений, картированных в области целевых регионов панели генов
  * среднее покрытие
  * выбранные для отчета мутации
* Таблица вариантов &ndash; основной инструмент интерпретации данных, объединяющий все источники аннотации с возможностью фильтрации
* Страница качества &ndash; набор данных QC от различных инструментов оценки качества файлов FASTQ, BAM и VCF
* Страница покрытия &ndash; набор данных для оценки покрытия, поиска непокрытых регионов и потенциально пропущенных мутаций

## Таблица образцов

Позволяет в наглядном виде оценить результаты проведенного анализа и пригодность образца к интерпретации. В графическом виде отображаются статусы образца:

<div class="img" align="center">

![Sample variants](/assets/sample_variants.png)
</div>
 
 Блок вариантов показывает общее количество нуклеотидных замен и наличие в образце строк из подключенных публичных и приватных баз мутаций, блок статусов отображает текущее состояние образца (по порядку сверху вниз):

 * Образец обработан, не закрыт.
 * Образец обработан, закрыт как положительный.
 * Образец обработан, закрыт как VUS.
 * Образец обработан, закрыт как отрицательный.
 * Образец в обработке.

Статусы Открыт/Положительный/VUS/Отрицательный служат только для удобства ведения учета образцов пользователем и никак не влияют на результаты анализа. Допускается менять их в любое время и в любой последовательности. 

Блок QC позволяет в удобном формате быстро оценить соответствие параметров образца (среднее покрытие, равномерность покрытия и долю непокрытых нуклеотидов) заданным в настройках панели критерям качества, при отклонении от этих критериев флаги окрашиваются в желтый или красный цвет.

В режимах QC и Скрининг таблицы образцов можно оценить качество секвенирования всего набора загруженных файлов и наличие патогенных мутаций - как обнаруженных автоматически, так и отмеченных вручную.

## Таблица аннотаций

Основной инструмент для интерпретации вариантов &ndash; содержит строки из файла VCF с аннотациями из геномных баз данных. По умолчанию включена фильтрация и сортировка для отображения наиболее важных вариантов:

* Соотношение аллелей выше 30% для герминальных вариантов и 5% для соматических
* Варианты с потенциальным влиянием на функцию белка (стоп-кодоны, сдвиги рамки считывания и др.)
* Варианты с записями патогенных мутаций в HGMD или ClinVar
* Варианты с частотой в геномах gnomAD3 менее 5%

Фильтры можно комбинировать в любых сочетаниях, также доступна сортировка по полям __hg38__, __Ген__ и __RD__, использование предварительной фильтрации снижает число анализируемых вариантов в десятки раз и значительно ускоряет интерпретацию образцов для большинства стандартных ситуаций.

В строке над таблицей подсчитывается количество патогенных мутаций и строк, включенных в отчет &ndash; это число не зависит от выбранных фильтров и позволяет обнаружить мутации, скрытые текущей фильтрацией.

<div class="img" align="center">

![Variants1](/assets/variants1.png)
</div>

Первое поле открывает окно настроек патогенной мутации для внесения строки в базы мутаций, второе поле включает мутацию в [отчет](report.md). В поле __hg38__ отображается информация о геномной координате и количестве инструментов, обнаруживших данный вариант &ndash; максимальной надежностью обладают варианты с двумя отметками. Нажатием на ссылку с координатой открывается [геномный браузер IGV](igv.md).

Выбранный с помощью базы MANE транскрипт можно посмотреть при наведении курсора на поле __Экзон__, поля __RD__, __AD__, __AB__ содержат информацию о покрытии и аллельном балансе варианта.

Поле __Фильтр__ зависит от содержания значения FILTER файла VCF &ndash; для PASS у герминальных вариантов показывается het или hom в зависимости от аллельного баланса, при невозможности предсказать генотип отображается ???. В иных случаях перечисляются все фильтры, которые сработали на данном варианте при оценке качества. У соматических вариантов для FILTER = PASS показывается значение Somatic или список фильтров, не позволивших признать этот вариант надежным.

Поля __Функция__ и __Регион__ показывают функциональное влияние варианта (стоп-кодон, миссенс-мутация и др.) и расположение относительно выбранного транскрипта (экзон, интрон, нетранслируемые области и т.д.).

<div class="img" align="center">

![Variants2](/assets/variants2.png)
</div>

Поле __Флаги__ отображает наиболее важные характеристики вариантов, на которые следует обращать внимание при интерпретации:

* HIGH &ndash; вариант может иметь сильное влияние на функцию белка (приводит к преждевременному стоп-кодону и т.д.), либо отмечен в базах HGMD или ClinVar как патогенный
* LoF &ndash; вариант может приводить к потере функции белка
* NMD &ndash; вариант может приводить к активации системы расщепления ошибочных мРНК, предотвращающей синтез дефектных белков
* HomoP &ndash; вариант в области гомополимера
* Rep &ndash; вариант в области повторов
* SA, SD &ndash; вариант в сайте сплайсинга (акцептор или донор)
* SR &ndash; вариант в области сайта сплайсинга (до 5 п.н.)
* Freq &ndash; вариант отсутствует в базе gnomAD, но встречается в проекте два и более раз
* OR &ndash; приблизительное значение отношения шансов (odds ratio)

Частота варианта в проекте для флагов Freq и OR расcчитывается в реальном времени и обновляется при добавлении или удалении образцов. Значение OR математически вычисляется как относительный риск (RR &ndash; отношение частот варианта в проекте и в базе данных геномов gnomAD3), но в диапазоне популяционных частот менее 1-5% численно близко к отношению шансов, которое является критерием PS4 в классификаторе ACMG. 

Флаги Freq и OR могут использоваться в качестве индикатора технических артефактов &ndash; если встречаемость варианта аномально высока (например, он найден у 80 образцов из 100 в проекте, но при этом не встречается в gnomAD), то скорее всего такая замена возникла из-за особенностей процесса подготовки библиотек или процесса секвенирования и она не является вариантом, присутствующим в геноме образца.

Поле __gnomAD__ содержит информацию о частотах варианта в различных популяциях базы данных gnomAD (версии 3.* для геномов и версии 2.* для экзомов), показывает значение [максимальной популяционной частоты](https://gnomad.broadinstitute.org/help/popmax).

Поля __dbSNP__, __OMIM__, __HGMD__, __ClinVar__ показывают информацию из соответствующих баз данных, поле __In&nbsp;silico__ в графическом виде отображает значения алгоритмов предсказания патогенности SIFT, PolyPhen HDIV/HVAR, Mutation Taster, FATHMM, CADD, DANN, M‑CAP, REVEL, BayesDel, ClinPred, LIST-S2.

Поле __xMD__ работает аналогично полям __HGMD__ и __ClinVar__, но использует доступные пользователю локальные базы данных мутаций в качестве источника, даже если они не подключены к текущему проекту.

## Страница варианта

Для просмотра детальной информации о варианте необходимо кликнуть на строку таблицы аннотаций &ndash; открывшаяся страница содержит несколько блоков с подробными данными о выбранной замене.

<div class="img" align="center">

![Variants detail 1](/assets/variant_detail1.png)
</div>

Верхний левый блок отображает геномные аннотации с возможностью копирования, в дополнение к аннотациям в таблице показывает значение QUAL из VCF, а также список инструментов, которые обнаружили данный вариант.

<div class="img" align="center">

![Variants detail 2](/assets/variant_detail2.png)
</div>

Блок ссылок дает возможность быстрого перехода на страницы ряда баз данных с дополнительной информацией об анализируемом варианте/гене. 

<div class="img" align="center">

![Variants detail 3](/assets/variant_detail3.png)
</div>

Блок частот показывает частоты для геномов и экзомов из gnomAD (по ссылке можно перейти на страницу базы данных), а также подсчитывает встречаемость варианта в проекте. Доступен поиск варианта как в текущем проекте, так и в других проектах пользователя.

<div class="img" align="center">

![Variants detail 4](/assets/variant_detail4.png)
</div>

В блоке [предсказательных алгоритмов](pipeline.md#innbspsilico) приводятся точные значения критериев патогенности.

<div class="img" align="center">

![Variants detail 5](/assets/variant_detail5.png)
</div>

Нижние блоки дублируют функционал кнопки добавления патогенных мутаций, а также содержат полный список транскриптов выбранного гена с характеристиками варианта в этих транскриптах.

## Страница качества (QC)

...

## Страница покрытия

...

## IGV

...

## ACMG

...

## HPO

...